import{a as I,r as n,j as t}from"./index-CBPv6F-N.js";import{X as P,S as E}from"./x-DqjBKJ4Y.js";import{S as A}from"./search-BoT7dOho.js";import{P as D}from"./plus-DFQj3cQy.js";import{T as F}from"./tag-DkMM0aZd.js";import{P as L}from"./pen-Bq_uJEvr.js";import{T as W}from"./trash-2-BjhHTPCW.js";function G({onClose:g,onSelect:o}){const{commentBank:l,addCommentBankItem:j,updateCommentBankItem:C,deleteCommentBankItem:w}=I(),[i,S]=n.useState(""),[d,k]=n.useState(new Set),[r,c]=n.useState(null),[f,m]=n.useState(!1),[x,p]=n.useState(""),[b,h]=n.useState(""),y=n.useMemo(()=>{const e=new Set;return l.forEach(s=>s.tags.forEach(a=>e.add(a))),Array.from(e).sort()},[l]),v=n.useMemo(()=>l.filter(e=>{const s=e.text.toLowerCase().includes(i.toLowerCase())||e.tags.some(u=>u.toLowerCase().includes(i.toLowerCase())),a=d.size===0||e.tags.some(u=>d.has(u));return s&&a}).sort((e,s)=>s.createdAt.localeCompare(e.createdAt)),[l,i,d]),N=e=>{c(e.id),p(e.text),h(e.tags.join(", ")),m(!1)},T=()=>{m(!0),c(null),p(""),h("")},z=()=>{const e=b.split(",").map(s=>s.trim()).filter(Boolean);if(r){const s=l.find(a=>a.id===r);s&&C({...s,text:x,tags:e}),c(null)}else j(x,e),m(!1)},B=e=>{k(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})};return t.jsx("div",{className:"modal-overlay",onClick:g,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),style:{width:600,maxWidth:"95vw",display:"flex",flexDirection:"column",maxHeight:"85vh"},children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{children:"Comment Bank"}),t.jsx("button",{className:"btn btn-ghost btn-icon",onClick:g,children:t.jsx(P,{size:18})})]}),t.jsxs("div",{className:"modal-body",style:{padding:0,display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},children:[t.jsxs("div",{style:{padding:16,borderBottom:"1px solid var(--border)",display:"flex",gap:12,flexDirection:"column"},children:[t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsxs("div",{className:"input-group",style:{flex:1},children:[t.jsx(A,{size:16,style:{color:"var(--text-dim)"}}),t.jsx("input",{type:"text",placeholder:"Search comments...",value:i,onChange:e=>S(e.target.value),style:{border:"none",background:"transparent",width:"100%"}})]}),t.jsxs("button",{className:"btn btn-primary",onClick:T,disabled:f||r!==null,children:[t.jsx(D,{size:16})," New"]})]}),y.length>0&&t.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:y.map(e=>t.jsx("button",{className:`btn btn-xs ${d.has(e)?"btn-primary":"btn-secondary"}`,onClick:()=>B(e),style:{borderRadius:12,fontSize:"0.75rem",padding:"2px 8px"},children:e},e))})]}),(f||r)&&t.jsxs("div",{style:{padding:16,background:"var(--bg-elevated)",borderBottom:"1px solid var(--border)"},children:[t.jsx("textarea",{value:x,onChange:e=>p(e.target.value),placeholder:"Write your comment here...",rows:3,style:{width:"100%",marginBottom:12},autoFocus:!0}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx(F,{size:14,className:"text-muted"}),t.jsx("input",{type:"text",value:b,onChange:e=>h(e.target.value),placeholder:"Tags (comma separated)",style:{flex:1}}),t.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>{m(!1),c(null)},children:"Cancel"}),t.jsxs("button",{className:"btn btn-primary btn-sm",onClick:z,disabled:!x.trim(),children:[t.jsx(E,{size:14})," Save"]})]})]}),t.jsx("div",{style:{flex:1,overflowY:"auto",padding:16},children:v.length===0?t.jsx("div",{className:"empty-state",children:"No comments found."}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:v.map(e=>t.jsxs("div",{className:"card",style:{padding:12,cursor:o?"pointer":"default",border:r===e.id?"1px solid var(--accent)":void 0},onClick:()=>o&&o(e.text),children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6},children:[t.jsx("div",{style:{fontSize:"0.95rem",whiteSpace:"pre-wrap",lineHeight:1.5},children:e.text}),!o&&t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("button",{className:"btn btn-ghost btn-icon btn-xs",onClick:s=>{s.stopPropagation(),N(e)},children:t.jsx(L,{size:12})}),t.jsx("button",{className:"btn btn-ghost btn-icon btn-xs",style:{color:"var(--red)"},onClick:s=>{s.stopPropagation(),w(e.id)},children:t.jsx(W,{size:12})})]})]}),e.tags.length>0&&t.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:e.tags.map(s=>t.jsx("span",{style:{fontSize:"0.7rem",background:"var(--bg-elevated)",padding:"2px 6px",borderRadius:4,color:"var(--text-dim)"},children:s},s))})]},e.id))})})]})]})})}export{G as C};
