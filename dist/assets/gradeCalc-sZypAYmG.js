function d(t,o){if(t.overridePoints!==void 0)return t.overridePoints;if(!t.levelId)return 0;const n=o.levels.find(i=>i.id===t.levelId);if(!n)return 0;const e=n.subItems.reduce((i,l)=>t.checkedSubItems.includes(l.id)?i+l.points:i,0),a=t.selectedPoints??n.minPoints;return n.subItems.length>0?Math.min(e+a,n.maxPoints):Math.max(n.minPoints,Math.min(n.maxPoints,a))}function u(t,o){let n=0;for(const e of t){const a=o.find(i=>i.id===e.criterionId);a&&(n+=d(e,a))}return n}function f(t){return t.reduce((o,n)=>{const e=Math.max(...n.levels.map(a=>a.maxPoints),0);return o+e},0)}function g(t,o){const n=o.reduce((a,i)=>a+i.weight,0);if(n===0)return h(t,o);let e=0;for(const a of o){const i=t.find(c=>c.criterionId===a.id),l=Math.max(...a.levels.map(c=>c.maxPoints),0);if(l===0)continue;const r=i?d(i,a):0;e+=r/l*a.weight}return e/n*100}function h(t,o){const n=f(o);return n===0?0:u(t,o)/n*100}function x(t,o){if(!o)return t;switch(o.type){case"percentage":return Math.min(100,Math.max(0,t+o.value));case"points":return Math.min(100,Math.max(0,t+o.value));case"level":return Math.min(100,Math.max(0,t+o.value*10));default:return t}}function M(t,o){const n=[...o.ranges].sort((e,a)=>a.min-e.min);for(const e of n)if(t>=e.min&&t<=e.max)return e.label;return"â€”"}function P(t,o){const n=[...o.ranges].sort((e,a)=>a.min-e.min);for(const e of n)if(t>=e.min&&t<=e.max)return e.color;return"#6b7280"}function v(t,o,n,e){const a=u(t.entries,o),i=f(o),l=(e==null?void 0:e.scoringMode)==="total-points"&&e.totalMaxPoints>0?e.totalMaxPoints:i,r=(e==null?void 0:e.scoringMode)==="total-points"?l>0?a/l*100:0:g(t.entries,o),c=x(r,t.globalModifier),m=t.entries.filter(s=>s.levelId!==null||s.overridePoints!==void 0).length;return{rawScore:a,maxRawScore:i,configuredMaxPoints:l,percentage:r,modifiedPercentage:c,letterGrade:M(c,n),gradeColor:P(c,n),gradedCount:m,totalCriteria:o.length}}function p(t,o){if(t.length===0)return{average:0,median:0,highest:0,lowest:0,distribution:[]};const n=t.map(r=>r.modifiedPercentage).sort((r,c)=>r-c),e=n.reduce((r,c)=>r+c,0)/n.length,a=Math.floor(n.length/2),i=n.length%2===0?(n[a-1]+n[a])/2:n[a],l=o.ranges.map(r=>({label:r.label,color:r.color,count:t.filter(c=>c.modifiedPercentage>=r.min&&c.modifiedPercentage<=r.max).length}));return{average:e,median:i,highest:n[n.length-1],lowest:n[0],distribution:l}}export{p as a,d as b,v as c};
