import{a as z,r as j,j as e,F as I,U as k,e as v}from"./index-CBPv6F-N.js";import{T as E}from"./Topbar-CFjW05tQ.js";import{c as P}from"./gradeCalc-sZypAYmG.js";import{L as F,a as R,b as A}from"./pdfExport-BoXWpiSs.js";import{C as D,S as G}from"./square-CdhrEp5H.js";function U(){var C;const{rubrics:o,students:g,studentRubrics:u,gradeScales:f,settings:N}=z(),[x,w]=j.useState(((C=o[0])==null?void 0:C.id)??""),[n,l]=j.useState(new Set),[c,m]=j.useState(!1),d=o.find(t=>t.id===x),h=f.find(t=>t.id===((d==null?void 0:d.gradeScaleId)??N.defaultGradeScaleId))??f[0],r=u.filter(t=>t.rubricId===x).map(t=>({sr:t,student:g.find(i=>i.id===t.studentId),summary:d?P(t,d.criteria,h):null})).filter(t=>t.student);function b(t){l(i=>{const s=new Set(i);return s.has(t)?s.delete(t):s.add(t),s})}function y(){n.size===r.length?l(new Set):l(new Set(r.map(t=>t.student.id)))}async function S(t){if(d){m(!0);try{if(t){const i=u.find(a=>a.rubricId===d.id&&a.studentId===t),s=g.find(a=>a.id===t);i&&s&&await R(i,d,s,h)}else{const i=r.filter(s=>n.has(s.student.id)).map(s=>({sr:s.sr,student:s.student}));await A(i,d,h)}}finally{m(!1)}}}return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"Export to PDF"}),e.jsxs("div",{className:"page-content fade-in",children:[e.jsx("div",{className:"card",style:{marginBottom:20},children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Rubric to Export"}),e.jsx("select",{value:x,onChange:t=>{w(t.target.value),l(new Set)},children:o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})}),d?r.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(k,{size:32}),e.jsx("p",{children:"No students have been graded with this rubric yet."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsxs("button",{className:"btn btn-ghost btn-sm",onClick:y,children:[n.size===r.length?e.jsx(D,{size:15}):e.jsx(G,{size:15}),n.size===r.length?"Deselect All":"Select All"]}),e.jsxs("span",{className:"text-muted text-sm",children:[n.size," of ",r.length," selected"]})]}),e.jsx("div",{style:{display:"flex",gap:10},children:e.jsxs("button",{className:"btn btn-primary",disabled:n.size===0||c,onClick:()=>S(),children:[c?e.jsx(F,{size:15,className:"spin"}):e.jsx(v,{size:15}),c?"Exportingâ€¦":`Export Selected (${n.size}) as ZIP`]})})]}),e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:40}}),e.jsx("th",{children:"Student"}),e.jsx("th",{children:"Grade"}),e.jsx("th",{children:"Score"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r.map(({sr:t,student:i,summary:s})=>{if(!i||!s)return null;const a=n.has(i.id);return e.jsxs("tr",{onClick:()=>b(i.id),style:{cursor:"pointer"},children:[e.jsx("td",{onClick:p=>p.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:a,onChange:()=>b(i.id)})}),e.jsx("td",{style:{fontWeight:500},children:i.name}),e.jsx("td",{children:e.jsx("span",{className:"grade-chip",style:{background:s.gradeColor+"22",color:s.gradeColor,border:`1.5px solid ${s.gradeColor}`,minWidth:36,height:36,fontSize:"1rem"},children:s.letterGrade})}),e.jsxs("td",{children:[s.modifiedPercentage.toFixed(1),"% (",s.rawScore,"/",s.maxRawScore,")"]}),e.jsxs("td",{children:[e.jsx("div",{className:"progress-bar",style:{width:120},children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${s.gradedCount/Math.max(s.totalCriteria,1)*100}%`}})}),e.jsxs("div",{className:"text-xs text-muted",children:[s.gradedCount,"/",s.totalCriteria]})]}),e.jsx("td",{onClick:p=>p.stopPropagation(),children:e.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:()=>S(i.id),disabled:c,children:[e.jsx(v,{size:13})," PDF"]})})]},i.id)})})]})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx(I,{size:32}),e.jsx("p",{children:"Select a rubric above."})]})]})]})}export{U as default};
