import{c as _,d as H,u as X,a as J,r as m,j as e,R as K,M as Q,B as U}from"./index-CBPv6F-N.js";import{T as V}from"./Topbar-CFjW05tQ.js";import{C as Y}from"./CommentBankModal-ZxPYeuEv.js";import{c as Z}from"./gradeCalc-sZypAYmG.js";import{A as ee}from"./arrow-left-BQjf5gsB.js";import{P as W}from"./paperclip-ZwBKu5Wg.js";import{S as te}from"./x-DqjBKJ4Y.js";import{C as se,S as ne}from"./square-CdhrEp5H.js";import"./search-BoT7dOho.js";import"./plus-DFQj3cQy.js";import"./tag-DkMM0aZd.js";import"./pen-Bq_uJEvr.js";import"./trash-2-BjhHTPCW.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=_("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function je(){var w,z,N;const{rubricId:x,studentId:h}=H(),j=X(),{rubrics:A,students:M,studentRubrics:T,attachments:B,gradeScales:v,settings:$,saveStudentRubric:y}=J(),o=A.find(t=>t.id===x),b=M.find(t=>t.id===h),S=v.find(t=>t.id===((o==null?void 0:o.gradeScaleId)??$.defaultGradeScaleId))??v[0],C=T.find(t=>t.rubricId===x&&t.studentId===h),[a,g]=m.useState(()=>{if(C)return C;if(!x||!h)return null;const t=((o==null?void 0:o.criteria)??[]).map(s=>({criterionId:s.id,levelId:null,comment:"",checkedSubItems:[],selectedPoints:void 0}));return{id:`${x}_${h}_${Date.now()}`,rubricId:x,studentId:h,entries:t,overallComment:"",isPeerReview:!1}}),[P,R]=m.useState(null),[f,p]=m.useState(null),[F,G]=m.useState(!1),[D,k]=m.useState(!1),u=m.useCallback((t,s)=>{a&&g(i=>{if(!i)return i;const n=i.entries.map(l=>l.criterionId===t?{...l,...s}:l);return{...i,entries:n}})},[a]),c=m.useMemo(()=>!a||!o?null:Z(a,o.criteria,S,o),[a,o,S]),O=m.useCallback(()=>{a&&(y({...a,gradedAt:new Date().toISOString()}),k(!0),setTimeout(()=>k(!1),2e3))},[a,y]);if(!o||!b||!a)return e.jsxs("div",{className:"page-content",children:["Rubric/Student not found. ",e.jsx("button",{onClick:()=>j(-1),children:"Back"})]});const r=o.format,I=r.levelOrder==="worst-first"?t=>[...t.levels].reverse():t=>t.levels,E=B.filter(t=>t.rubricId===x);function L(t,s){const i=t.checkedSubItems??[],n=i.includes(s)?i.filter(l=>l!==s):[...i,s];u(t.criterionId,{checkedSubItems:n})}return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:`Grading: ${b.name}`,actions:e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-sm",onClick:()=>j(-1),children:[e.jsx(ee,{size:15})," Back"]}),e.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:()=>G(t=>!t),children:[e.jsx(W,{size:15})," Attachments"]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:O,children:[e.jsx(te,{size:15})," ",D?"Saved!":"Save"]})]})}),e.jsxs("div",{className:"page-content fade-in",children:[c&&e.jsxs("div",{className:"card",style:{marginBottom:20,display:"flex",alignItems:"center",gap:24,flexWrap:"wrap"},children:[e.jsxs("div",{style:{background:c.gradeColor+"22",border:`2px solid ${c.gradeColor}`,borderRadius:10,padding:"6px 18px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800,color:c.gradeColor},children:c.letterGrade}),e.jsx("div",{style:{fontSize:"0.72rem",color:"var(--text-muted)",fontWeight:600},children:"GRADE"})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:700},children:[c.modifiedPercentage.toFixed(1),"%"]}),e.jsx("div",{className:"text-muted text-xs",children:o.scoringMode==="total-points"?"Percentage":"Weighted Score"})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:700},children:[c.rawScore," / ",c.configuredMaxPoints]}),e.jsx("div",{className:"text-muted text-xs",children:"Total Points"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,minWidth:180,marginLeft:"auto"},children:[e.jsx("span",{style:{fontSize:"0.72rem",color:"var(--text-muted)",fontWeight:600,textTransform:"uppercase"},children:"Better/Worse Modifier"}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsxs("select",{value:((w=a.globalModifier)==null?void 0:w.type)??"percentage",onChange:t=>g(s=>{var i,n;return s&&{...s,globalModifier:{type:t.target.value,value:((i=s.globalModifier)==null?void 0:i.value)??0,reason:((n=s.globalModifier)==null?void 0:n.reason)??""}}}),style:{flex:1},children:[e.jsx("option",{value:"percentage",children:"% offset"}),e.jsx("option",{value:"points",children:"Points offset"})]}),e.jsx("input",{type:"number",value:((z=a.globalModifier)==null?void 0:z.value)??0,onChange:t=>g(s=>{var i,n;return s&&{...s,globalModifier:{type:((i=s.globalModifier)==null?void 0:i.type)??"percentage",value:Number(t.target.value),reason:((n=s.globalModifier)==null?void 0:n.reason)??""}}}),style:{width:60}})]})]})]}),e.jsx("div",{style:{overflowX:"auto",marginBottom:20},children:e.jsxs("table",{className:"rubric-grid",style:{fontFamily:r.fontFamily,fontSize:r.fontSize},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:r.headerColor,color:r.headerTextColor},children:[e.jsx("th",{style:{width:r.criterionColWidth,textAlign:"left",padding:"14px 16px"},children:"Criterion"}),(N=o.criteria[0])==null?void 0:N.levels.map((t,s)=>{const i=I(o.criteria[0])[s];return e.jsxs("th",{style:{width:r.levelColWidth},children:[i==null?void 0:i.label,r.showPoints&&i?` (${i.minPoints}${i.minPoints!==i.maxPoints?`–${i.maxPoints}`:""}pts)`:""]},s)}),e.jsx("th",{style:{width:60}}),r.showWeights&&e.jsx("th",{style:{width:72},children:"Wt%"})]})}),e.jsx("tbody",{children:o.criteria.map(t=>{const s=a.entries.find(n=>n.criterionId===t.id),i=I(t);return t.levels.find(n=>n.id===s.levelId),e.jsxs(K.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"criterion-cell",children:[e.jsx("div",{style:{fontWeight:600},children:t.title}),t.description&&e.jsx("div",{style:{fontSize:"0.78em",color:"var(--text-muted)",marginTop:3},children:t.description}),t.linkedStandard&&e.jsxs("div",{style:{marginTop:6,fontSize:"0.7em",color:"var(--accent)",display:"flex",alignItems:"center",gap:4},title:t.linkedStandard.description,children:[e.jsx(ie,{size:10})," ",t.linkedStandard.statementNotation??"Standard"]}),s.overridePoints!==void 0&&e.jsxs("div",{style:{fontSize:"0.75em",color:"var(--yellow)",marginTop:4},children:["Override: ",s.overridePoints,"pts"]})]}),i.map(n=>{const l=s.levelId===n.id;return e.jsxs("td",{className:`level-cell ${l?"selected":""}`,style:l?{borderColor:r.accentColor,boxShadow:`inset 0 0 0 2px ${r.accentColor}`}:{},onClick:()=>u(t.id,{levelId:l?null:n.id,overridePoints:void 0}),children:[n.description||e.jsx("span",{style:{color:"var(--text-dim)",fontSize:"0.8em"},children:"Select"}),r.showPoints&&e.jsx("div",{style:{fontSize:"0.75em",color:l?r.accentColor:"var(--text-muted)",marginTop:6,fontWeight:600},children:n.minPoints===n.maxPoints?`${n.minPoints}pts`:`${n.minPoints}–${n.maxPoints}pts`}),l&&e.jsxs("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid var(--border)",textAlign:"left"},onClick:d=>d.stopPropagation(),children:[n.subItems.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:8},children:n.subItems.map(d=>{const q=(s.checkedSubItems??[]).includes(d.id);return e.jsxs("div",{onClick:()=>L(s,d.id),style:{display:"flex",gap:6,alignItems:"start",fontSize:"0.75em",cursor:"pointer",lineHeight:1.3},children:[e.jsx("div",{style:{flexShrink:0,marginTop:1},children:q?e.jsx(se,{size:14,color:r.accentColor}):e.jsx(ne,{size:14,color:"var(--text-muted)"})}),e.jsxs("span",{children:[d.label," ",e.jsxs("span",{style:{opacity:.6},children:["(+",d.points,")"]})]})]},d.id)})}),(n.minPoints!==n.maxPoints||n.subItems.length===0)&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("label",{style:{fontSize:"0.7em",color:"var(--text-muted)",textTransform:"uppercase"},children:n.subItems.length>0?"Base Points":"Points"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"range",min:n.minPoints,max:n.maxPoints,step:.5,value:s.selectedPoints??n.minPoints,onChange:d=>u(t.id,{selectedPoints:Number(d.target.value)}),style:{flex:1,accentColor:r.accentColor}}),e.jsx("div",{style:{fontSize:"0.75em",fontWeight:600,minWidth:24,textAlign:"right"},children:s.selectedPoints??n.minPoints})]})]})]})]},n.id)}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-ghost btn-icon btn-sm",onClick:()=>R(P===t.id?null:t.id),style:{color:s.comment?"var(--accent)":"var(--text-dim)"},children:e.jsx(Q,{size:15})})}),r.showWeights&&e.jsxs("td",{style:{textAlign:"center",color:"var(--text-muted)",fontSize:"0.8em"},children:[t.weight,"%"]})]}),P===t.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:i.length+2+(r.showWeights?1:0),style:{background:"var(--bg-elevated)",padding:12},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("textarea",{placeholder:"Add a comment…",value:s.comment,onChange:n=>u(t.id,{comment:n.target.value}),rows:2,style:{flex:1}}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>p(t.id),title:"Open Comment Bank",children:e.jsx(U,{size:16})})]})})})]},t.id)})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Overall Comment"}),e.jsx("textarea",{placeholder:"General feedback…",value:a.overallComment,onChange:t=>g(s=>s&&{...s,overallComment:t.target.value}),rows:3})]})}),F&&e.jsxs("div",{className:"card",style:{marginTop:16},children:[e.jsx("h3",{children:"Attachments"}),E.map(t=>e.jsxs("div",{style:{marginTop:6},className:"text-sm",children:[e.jsx(W,{size:12})," ",t.name]},t.id))]})]}),f&&e.jsx(Y,{onClose:()=>p(null),onSelect:t=>{if(!f)return;const s=a.entries.find(i=>i.criterionId===f);if(s){const i=s.comment||"",n=i&&!i.endsWith(" ")?" ":"";u(f,{comment:i+n+t})}p(null)}})]})}export{je as default};
